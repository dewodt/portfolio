---
import LayoutBase from "../layouts/LayoutBase.astro";
import { Image } from "astro:assets";
import type { HomePageQueryResult } from "@/types/sanity";
import CustomPortableText from "@/components/ui/portable-text/CustomPortableText.astro";
import { sanityClient, homePageQuery } from "@/lib/query";
import { toPlainText } from "astro-portabletext";
import Divider from "@/components/ui/Divider.astro";
import SkillBadge from "@/components/ui/badge/SkillBadge.astro";
import MapPinIcon from "@/components/icons/MapPinIcon.astro";
import CardEducation from "@/components/ui/card/CardEducation.astro";
import type { PortableTextBlock } from "@portabletext/types";

const educationData = [
  {
    image: "https://placehold.co/112x112/1a1a2e/e0e0e0?text=UB",
    imageAlt: "Universitas Brawijaya logo",
    degree: "Bachelor of Computer Science",
    university: "Universitas Brawijaya",
    startDate: "2021-08-01",
    endDate: "2025-08-01",
    description:
      "Focused on software engineering, algorithms, and web development. Active in competitive programming and open-source communities.",
  },
  {
    image: "https://placehold.co/112x112/1a1a2e/e0e0e0?text=HS",
    imageAlt: "SMAN 1 Kediri logo",
    degree: "Natural Sciences",
    university: "SMAN 1 Kediri",
    startDate: "2018-07-01",
    endDate: "2021-05-01",
    description:
      "Graduated with honors. Participated in various science olympiads and technology-related extracurricular activities.",
  },
];

// Get home page data
const homePageData =
  await sanityClient.fetch<HomePageQueryResult>(homePageQuery);
if (!homePageData) {
  throw new Error("Home data not found");
}

// Cast content to PortableTextBlock array for type safety
const portableTextContent = homePageData.content as PortableTextBlock[];
---

<LayoutBase
  title={homePageData.title}
  description={toPlainText(portableTextContent)}
>
  <main class="flex flex-auto flex-col gap-16 sm:gap-24">
    <!-- Hero -->
    <section
      class="relative flex min-h-[calc(100vh-6rem)] flex-auto items-center justify-center px-5 py-12 sm:min-h-[calc(100vh-10rem)] sm:p-12 lg:p-16"
    >
      <div
        class="relative flex flex-col items-center gap-6 md:flex-row-reverse md:gap-10 lg:gap-16 xl:gap-24"
      >
        {/* My Photo */}
        <div
          class="animate-fade-in-scale relative opacity-0"
          style="animation-delay: 0.1s;"
        >
          {/* Ambient glow layer 1 */}
          <div
            class="bg-primary/20 animate-pulse-glow absolute -inset-6 rounded-[20%] blur-3xl"
            aria-hidden="true"
          >
          </div>
          {/* Ambient glow layer 2 */}
          <div
            class="bg-accent/15 animate-pulse-glow absolute -inset-3 rounded-[20%] blur-2xl"
            style="animation-delay: 1.5s;"
            aria-hidden="true"
          >
          </div>
          {/* Photo */}
          <Image
            class="border-border/50 bg-card text-secondary relative flex size-56 items-center justify-evenly rounded-[20%] border text-base font-medium lg:size-80"
            src={homePageData.image.url!}
            alt={homePageData.image.alt}
            widths={[224, 320, 512]}
            sizes="(max-width: 1023px) 224px, 320px"
            loading="eager"
            inferSize
          />
        </div>

        {/* Texts */}
        {/* Need to override default margin from portable text */}
        <div
          class="flex max-w-xs flex-col text-center md:max-w-[27rem] md:text-start lg:max-w-lg"
        >
          {/* Engineer label + Location */}
          <div
            class="animate-fade-in-up mb-2 flex flex-col items-center gap-1 font-mono text-xs tracking-widest uppercase opacity-0 md:flex-row md:gap-0 lg:mb-3 lg:text-sm"
            style="animation-delay: 0.2s;"
          >
            <span class="text-primary">Software Engineer & Hiker</span>
            <span class="text-muted hidden md:inline">&nbsp;Â·&nbsp;</span>
            <span class="text-muted flex items-center gap-1">
              <MapPinIcon class="size-3 lg:size-3.5" />
              Jakarta, Indonesia
            </span>
          </div>

          {/* Title */}
          <h1
            class="text-secondary animate-fade-in-up mb-3 text-3xl font-bold tracking-tight opacity-0 lg:mb-4 lg:text-5xl"
            style="animation-delay: 0.3s;"
          >
            {homePageData.title}
          </h1>

          {/* Paragraph */}
          <div
            class="animate-fade-in-up opacity-0 [&>*]:my-0 [&>*]:lg:my-0"
            style="animation-delay: 0.4s;"
          >
            <CustomPortableText value={portableTextContent} />
          </div>
        </div>
      </div>
    </section>

    {/* Section divider */}
    <Divider class="mx-auto max-w-xs sm:max-w-2xl lg:max-w-4xl" />

    <!-- Education -->
    <section class="flex flex-auto justify-center px-5 py-12 sm:p-12 lg:p-16">
      <div class="flex w-full max-w-3xl flex-col gap-6">
        <div class="flex flex-col text-center">
          <span
            class="animate-fade-in-up text-primary mb-1 font-mono text-xs tracking-widest uppercase opacity-0 lg:mb-2 lg:text-sm"
            style="animation-delay: 0.1s;"
          >
            Education
          </span>
          <h2
            class="animate-fade-in-up text-secondary mb-2 text-2xl font-bold tracking-tight opacity-0 lg:mb-3 lg:text-3xl"
            style="animation-delay: 0.2s;"
          >
            Education
          </h2>
          <p
            class="animate-fade-in-up text-muted text-base opacity-0 lg:text-lg"
            style="animation-delay: 0.3s;"
          >
            My educational journey and academic foundations.
          </p>
        </div>

        {/* Timeline */}
        <div class="relative w-full">
          {/* Continuous vertical line */}
          <div
            class="animate-grow-down bg-border absolute top-0 bottom-0 left-[5px] w-px origin-top"
            style="animation-delay: 0.3s; transform: scaleY(0);"
          >
          </div>

          <ul class="flex flex-col gap-6 lg:gap-8">
            {
              educationData.map((edu, index) => (
                <li
                  class="animate-fade-in-up relative pl-8 opacity-0 lg:pl-10"
                  style={`animation-delay: ${0.3 + index * 0.05}s;`}
                >
                  {/* Timeline dot */}
                  <div class="bg-primary ring-background absolute top-5 left-0 z-10 size-3 rounded-full ring-4" />
                  <CardEducation
                    image={edu.image}
                    imageAlt={edu.imageAlt}
                    degree={edu.degree}
                    university={edu.university}
                    startDate={edu.startDate}
                    endDate={edu.endDate}
                    description={edu.description}
                  />
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    </section>

    {/* Section divider */}
    <Divider class="mx-auto max-w-xs sm:max-w-2xl lg:max-w-4xl" />

    <!-- Skills -->
    <section class="flex flex-auto justify-center px-5 py-12 sm:p-12 lg:p-16">
      <div class="flex w-full max-w-3xl flex-col gap-6">
        <div class="flex flex-col text-center">
          <span
            class="animate-fade-in-up text-primary mb-1 font-mono text-xs tracking-widest uppercase opacity-0 lg:mb-2 lg:text-sm"
            style="animation-delay: 0.1s;"
          >
            Tools & Technologies
          </span>
          <h2
            class="animate-fade-in-up text-secondary mb-2 text-2xl font-bold tracking-tight opacity-0 lg:mb-3 lg:text-3xl"
            style="animation-delay: 0.2s;"
          >
            {homePageData.skillsSectionTitle}
          </h2>
          <p
            class="animate-fade-in-up text-muted text-base opacity-0 lg:text-lg"
            style="animation-delay: 0.3s;"
          >
            {homePageData.skillsSectionDescription}
          </p>
        </div>

        <div class="space-y-10">
          {
            homePageData.skillCategories.map((category, categoryIndex) => (
              <div
                class="animate-fade-in-up space-y-4 opacity-0"
                style={`animation-delay: ${0.1 + categoryIndex * 0.1}s;`}
              >
                <h3 class="text-muted text-center font-mono text-xs tracking-widest uppercase lg:text-sm">
                  {category.categoryTitle}
                </h3>
                <ul class="flex flex-row flex-wrap justify-center gap-2.5">
                  {category.skills.map((skill) => (
                    <li>
                      <SkillBadge logo={skill.logo!} title={skill.title} />
                    </li>
                  ))}
                </ul>
              </div>
            ))
          }
        </div>
      </div>
    </section>
  </main>
</LayoutBase>
