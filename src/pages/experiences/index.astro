---
import CardExperience from "@/components/ui/card/CardExperience.astro";
import LayoutBase from "@/layouts/LayoutBase.astro";
import type {
  AllExperiencesQueryResult,
  ExperiencePageQueryResult,
} from "@/types/sanity";
import {
  sanityClient,
  experiencePageQuery,
  allExperiencesQuery,
} from "@/lib/query";

// Get experiences page from CMS
const experiencePageData =
  await sanityClient.fetch<ExperiencePageQueryResult>(experiencePageQuery);
// Get all experiences from CMS
const allExperienceData =
  await sanityClient.fetch<AllExperiencesQueryResult>(allExperiencesQuery);

if (!experiencePageData) {
  throw new Error("Failed to fetch experiences page data");
}
---

<LayoutBase
  title={`${experiencePageData.title} | Dewantoro Triatmojo`}
  description={experiencePageData.description}
>
  <main class="flex flex-auto justify-center px-5 py-10 sm:p-12 lg:p-14">
    <section
      class="flex w-full max-w-3xl flex-col items-center gap-8 lg:gap-10"
    >
      {/* Header */}
      <div class="flex flex-col text-center">
        <span
          class="text-primary animate-fade-in-up mb-1 font-mono text-xs tracking-widest uppercase lg:mb-2 lg:text-sm"
          style="animation-delay: 0.1s;"
        >
          {experiencePageData.monoLabel}
        </span>
        <h1
          class="text-secondary animate-fade-in-up mb-2 text-3xl font-bold lg:mb-3 lg:text-5xl"
          style="animation-delay: 0.2s;"
        >
          {experiencePageData.title}
        </h1>
        <p
          class="text-muted animate-fade-in-up text-base lg:text-lg"
          style="animation-delay: 0.3s;"
        >
          {experiencePageData.description}
        </p>
      </div>

      {/* Timeline */}
      <div class="relative w-full">
        {/* Continuous vertical line */}
        <div
          class="bg-border animate-grow-down absolute top-0 bottom-0 left-[5px] w-px origin-top"
          style="animation-delay: 0.3s; transform: scaleY(0);"
        >
        </div>

        <ul class="flex flex-col gap-6 lg:gap-8">
          {
            allExperienceData.map((experience, index) => (
              <li
                class="animate-fade-in-up relative pl-6 sm:pl-8"
                style={`animation-delay: ${0.4 + index * 0.1}s;`}
              >
                {/* Timeline dot */}
                <div class="bg-primary ring-background absolute top-5 left-0 z-10 size-3 rounded-full ring-4" />
                <CardExperience experience={experience} />
              </li>
            ))
          }
        </ul>
      </div>
    </section>
  </main>
</LayoutBase>
