---
import { Image } from "astro:assets";
import { getFormattedDate } from "@/lib/utils";
import type { AllProjectsQueryResult } from "@/types/sanity";
import CardDescription from "./shared/CardDescription.astro";
import CardMetaDateRange from "./shared/CardMetaDateRange.astro";
import CardPills from "./shared/CardPills.astro";
import CardTitle from "./shared/CardTitle.astro";

interface Props {
  project: AllProjectsQueryResult[number];
}

const { project } = Astro.props;

const formattedStartDate = getFormattedDate(project.dateRange.startDate);
const formattedEndDate = project.dateRange.endDate
  ? getFormattedDate(project.dateRange.endDate)
  : null;
---

<article
  class="group/card border-border bg-card hover:border-border-hover/80 hover:drop-shadow-primary relative flex h-full flex-col overflow-hidden rounded-xl border transition-all duration-300 hover:-translate-y-1.5"
>
  {/* Gradient glow pseudo-element */}
  <div
    class="bg-primary/0 group-hover/card:bg-primary/10 dark:group-hover/card:bg-primary/15 pointer-events-none absolute -inset-px -z-10 rounded-xl blur-xl transition-all duration-500"
  >
  </div>

  {/* Full-card anchor */}
  <a
    href={`/projects/${project.slug.current}`}
    aria-label={`Link to project ${project.title}`}
    class="absolute inset-0 z-30"></a>

  {/* Image wrapper — provides contrast in light mode */}
  <div
    class="bg-surface border-border group-hover/card:border-border-hover/80 relative overflow-hidden rounded-t-xl border-b transition-colors duration-300 dark:border-none"
  >
    <Image
      class="bg-surface text-secondary flex aspect-video w-full items-center justify-evenly object-cover object-center text-base font-medium transition-transform duration-700 group-hover/card:scale-[1.03]"
      src={project.image.url!}
      alt={project.image.alt}
      widths={[320, 384, 640, 768]}
      sizes="(max-width: 1023px) 320px, 384px"
      inferSize
    />
    {/* Gradient overlay on hover */}
    <div
      class="from-primary/10 absolute inset-0 bg-linear-to-t via-transparent opacity-0 transition-opacity duration-500 group-hover/card:opacity-100"
    >
    </div>
  </div>

  {/* Content */}
  <div class="flex flex-1 flex-col px-4 pt-4 pb-3">
    {/* Date range */}
    <CardMetaDateRange
      startDate={project.dateRange.startDate}
      endDate={project.dateRange.endDate}
      class="mb-1"
    >
      <Fragment slot="start">{formattedStartDate}</Fragment>
      <Fragment slot="end">{formattedEndDate}</Fragment>
    </CardMetaDateRange>

    {/* Title + arrow */}
    <CardTitle class="mb-2">{project.title}</CardTitle>

    {/* Description */}
    <CardDescription class="line-clamp-3">{project.description}</CardDescription
    >

    {/* Links row — rounded-full pill style */}
    <CardPills
      repositoryLinks={project.repositoryLinks}
      deploymentLinks={project.deploymentLinks}
      class="mt-auto pt-2"
    />
  </div>
</article>
